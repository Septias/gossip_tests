<!DOCTYPE html>
<html>

<head>
    <title> Gossip Testing </title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <meta icon="icon" href="icon.png" />
    <script src="webxdc.js"></script>
    <style type="text/css">
        body {
            font-family: Helvetica, Arial, sans-serif;
            display: grid;
            justify-items: stretch;
            padding: 1em;
            background: #BEA8A7;
        }

        h1 {
            text-align: center;
            color: #0D1821;
        }

        label {
            color: #0D1821;
        }

        .ui {
            display: flex;
            flex-direction: column;
            margin-bottom: 1em;
            background: #F4DBD8;
            padding: 1em;
            border-radius: 0.5em;
            max-width: 500px;
            width: 100%;
        }

        .wrapper {
            display: flex;
            justify-content: center;
        }


        input {
            background: #BEA8A7;
            border: none;
            border-radius: 0.5em;
            padding: 8px 4px;
        }

        input::placeholder {
            color:#ddbdbb;
        }

        #output {
            display: flex;
            flex-direction: column;
            border: 2px dotted #65524D;
            min-height: 300px;
            border-radius: 0.5em;
            padding: 0.5em;
        }

        button {
            background: #C09891;
            border: none;
            border-radius: 0.5em;
            padding: 8px 4px;
            color: #0D1821;
            cursor: pointer;
            font: bold;
        }

        button:disabled {
            background: #BEA8A7;
            cursor: not-allowed;
        }
    </style>
</head>



<body>
    <h1> Gossip Testing </h1>
    <div class="wrapper">
        <div class="ui">
            <label style="margin-bottom: 2px"> Message </label>
            <input id="message" placeholder="message" style="margin-bottom: 1em"></input>
            <button id="sendGossip" onclick="sendGossip()" style="margin-bottom: 0.5em" disabled="true"> Send GOSSIP
            </button>
            <button onclick="sendMsg()" style="margin-bottom: 0.5em"> Send SMTP </button>

            <h1> Output </h1>
            <div id="output"></div>
        </div>
    </div>


    <script>

        var El = function (tag, text) {
            var el = document.createElement(tag);
            el.innerText = text || '';
            return el;
        };

        window.webxdc.setUpdateListener(function (update) {
            console.log("Received SMTP: ", update.payload);
            var output = document.getElementById('output');
            output.appendChild(El('span', "SMTP(" + window.webxdc.selfAddr + "): " + update.payload.msg));
        });

        let sendGossip = () => { console.log("not ready") }

        window.webxdc.setEphemeralUpdateListener(function (update) {
            console.log("Received Gossip: ", update);
            var output = document.getElementById('output');
            output.appendChild(El('span', "GOSSIP(" + window.webxdc.selfAddr + "): " + update));
        }).then(() => {
            document.getElementById('sendGossip').disabled = false;
            sendGossip = () => {
                let msg = document.getElementById('message').value;
                console.log("New Gossip message: ", msg);
                window.webxdc.sendEphemeralUpdate(msg);
            }
        });

        function sendMsg() {
            let msg = document.getElementById('message').value;
            console.log("New SMTP message: ", msg);

            window.webxdc.sendUpdate({
                payload: {
                    name: window.webxdc.selfName,
                    msg,
                },
            }, "");
        }
    </script>
</body>

</html>